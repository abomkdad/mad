<!DOCTYPE html>
<html>
<head>
<title>صورة مع دبابيس متعددة - بحث بالاسم مع إخفاء ووميض مستمر (حفظ المواقع)</title>
<style>
  body { margin: 0; display: flex; flex-direction: column; align-items: center; }
  .image-container {
    position: relative;
    display: inline-block;
    cursor: default;
  }
  .map-image {
    width: 1080px;
    height: 1920px;
    background-color: #eee; /* لون رمادي فاتح كدلالة على أنها فارغة */
  }
  .pin {
    position: absolute;
    background-color: rgba(255, 0, 0, 0.7);
    color: white;
    padding: 5px;
    border: 1px solid red;
    border-radius: 5px;
    cursor: grab;
    font-size: 14px;
    white-space: nowrap;
    transform: translate(-50%, -50%);
    transition: border-color 0.3s ease-in-out;
  }
  .pin.highlighted {
    border-color: yellow;
    border-width: 3px;
  }
  .pin.flash {
    animation: flashAnimation 1s infinite alternate; /* تشغيل الرسوم المتحركة بشكل متكرر */
  }

  @keyframes flashAnimation {
    from { border-color: yellow; }
    to { border-color: orange; }
  }

  #search-container { margin-bottom: 10px; }
  #search-input { padding: 8px; width: 300px; border: 1px solid #ccc; border-radius: 4px; placeholder: ابحث عن اسم دبوس; }
</style>
</head>
<body>

  <div id="search-container">
    <input id="search-input" type="text" placeholder="ابحث عن اسم دبوس">
  </div>

  <div class="image-container" id="imageContainer">
    <div class="map-image" id="map-placeholder"></div>
  </div>

  <script>
    console.log("بدء تشغيل الكود...");

    document.addEventListener('DOMContentLoaded', function() {
      console.log("تم تحميل DOM.");

      const imageContainer = document.getElementById('imageContainer');
      if (!imageContainer) {
        console.error("لم يتم العثور على imageContainer!");
        return;
      }

      const pinsData = []; // لتخزين بيانات الدبابيس (الاسم والموقع وعنصر DOM)
      let activePin = null;
      let offsetX, offsetY;

      const pinNames = [
        "TitleA101", "A102", "A104", "A105", "A113", "A114", "A115", "B102", "B104", "B106", "B107", "B108", "B110", "C101", "C108", "C109", "D.110", "D102", "E104", "F101", "G101", "G103", "H101", "H106", "I101", "I102", "I104", "J101", "J102", "J103", "J104", "J105", "J107", "J109", "K101", "L101", "L102", "L103", "L103 EXTRA", "L105", "L106", "P101", "P102", "P103", "P104", "P105", "P109", "Q102", "Q105", "Q107", "Q109", "Q112", "Q113", "Q114", "Q115", "Q116", "Q117", "Q118", "Q119", "Q120", "Q121", "R103", "S102", "T102", "T106", "أو Q108T107", "T109", "T109 EXTRA", "V102", "W111", "W120", "W122", "W126", "W128", "W129", "W133", "W139", "W143", "W150", "W158", "W160", "W161", "W163", "W164", "W170", "W171", "W172", "W173", "W174", "W180", "W181", "W183", "W183 Extra", "W184", "W189", "W190", "W191", "W192", "W198x102", "Y101", "Y102", "A104", "A112", "A113", "A114", "A117", "A118", "A120", "A121", "A122", "B103", "B105", "B106", "B110", "C119c120", "C121", "C122", "C123", "C126", "D104", "D114", "D117", "D119", "D121", "E.117", "E101", "E104", "G103", "G104", "G106", "G107", "G108", "G109", "G110", "G111", "H103", "H104", "I102", "J101", "J102", "J103", "J104 أو Q103", "K101", "L101", "L102", "L103", "L112", "M101", "M104", "N101", "N105", "N106", "P101", "P104", "P105", "P107", "Q111", "Q117", "R105", "R109", "R110", "S101", "S112", "T101", "T103 نساء أو Q101", "U101", "V101", "V102", "V105", "V106", "V107", "V109", "V110", "V113", "V114", "W101", "W113", "W125", "W144", "W150", "W152", "W153", "W154", "W155", "W160", "W162", "W164", "W165", "W169", "W175", "W179", "W184", "W185", "W190", "W197", "W201", "W203", "W208", "W209", "W213", "W214", "W217", "W222", "W230", "Y102", "Y101", "Z101", "Z102", "موقع 1", "موقع 2", "نقطة اهتمام", "مكان هام", "عنوان هنا", "نقطة التقاء", "مركز المدينة", "طرف المدينة", "حي سكني", "منطقة صناعية", "شارع رئيسي", "زقاق فرعي"
      ];

      function getRandomPosition() {
        const randomX = Math.random() * 100;
        const randomY = Math.random() * 100;
        return { x: randomX + '%', y: randomY + '%' };
      }

      // محاولة تحميل مواقع الدبابيس المحفوظة
      const savedPins = localStorage.getItem('pinPositions');
      if (savedPins) {
        const parsedPins = JSON.parse(savedPins);
        parsedPins.forEach(pinData => {
          const pin = document.createElement('div');
          pin.classList.add('pin');
          pin.textContent = pinData.name;
          pin.style.left = pinData.x;
          pin.style.top = pinData.y;
          pin.addEventListener('mousedown', startDrag);
          imageContainer.appendChild(pin);
          pinsData.push({ name: pinData.name, x: pinData.x, y: pinData.y, element: pin });
          console.log(`تم تحميل دبوس باسم: ${pinData.name} في الموضع: ${pinData.x}, ${pinData.y}`);
        });
      } else {
        // إذا لم يتم العثور على بيانات محفوظة، قم بإنشاء الدبابيس بشكل عشوائي
        pinNames.forEach(name => {
          const pin = document.createElement('div');
          pin.classList.add('pin');
          pin.textContent = name;
          const position = getRandomPosition();
          pin.style.left = position.x;
          pin.style.top = position.y;
          pin.addEventListener('mousedown', startDrag);
          imageContainer.appendChild(pin);
          pinsData.push({ name: name, x: position.x, y: position.y, element: pin });
          console.log(`تم إنشاء دبوس باسم: ${name} في الموضع: ${position.x}, ${position.y}`);
        });
      }

      const searchInput = document.getElementById('search-input');

      searchInput.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase();

        pinsData.forEach(pinInfo => {
          const pinElement = pinInfo.element;
          const pinNameLower = pinInfo.name.toLowerCase();

          if (pinNameLower.includes(searchTerm)) {
            pinElement.classList.add('highlighted', 'flash');
            pinElement.style.display = 'block';
          } else {
            pinElement.style.display = 'none';
            pinElement.classList.remove('highlighted');
            pinElement.classList.remove('flash');
          }
        });

        if (!searchTerm) {
          pinsData.forEach(pinInfo => {
            pinInfo.element.style.display = 'block';
            pinInfo.element.classList.remove('highlighted');
            pinInfo.element.classList.remove('flash');
          });
        }
      });

      function startDrag(event) {
        activePin = event.target;
        activePin.style.cursor = 'grabbing';

        offsetX = event.clientX - activePin.getBoundingClientRect().left;
        offsetY = event.clientY - activePin.getBoundingClientRect().top;

        imageContainer.addEventListener('mousemove', drag);
        imageContainer.addEventListener('mouseup', endDrag);
      }

      function drag(event) {
        if (!activePin) return;

        const containerRect = imageContainer.getBoundingClientRect();
        let x = event.clientX - containerRect.left - offsetX;
        let y = event.clientY - containerRect.top - offsetY;

        x = Math.max(0, Math.min(x, containerRect.width - activePin.offsetWidth));
        y = Math.max(0, Math.min(y, containerRect.height - activePin.offsetHeight));

        activePin.style.left = (x / containerRect.width) * 100 + '%';
        activePin.style.top = (y / containerRect.height) * 100 + '%';
      }

      function endDrag() {
        if (!activePin) return;

        activePin.style.cursor = 'grab';
        const finalX = activePin.style.left;
        const finalY = activePin.style.top;
        const pinName = activePin.textContent;

        const pinIndex = pinsData.findIndex(pin => pin.name === pinName);
        if (pinIndex > -1) {
          pinsData[pinIndex].x = finalX;
          pinsData[pinIndex].y = finalY;
          console.log("تم تحديث موقع الدبوس:", pinsData);
          // حفظ مواقع الدبابيس في localStorage
          localStorage.setItem('pinPositions', JSON.stringify(pinsData));
        }

        activePin = null;
        imageContainer.removeEventListener('mousemove', drag);
        imageContainer.removeEventListener('mouseup', endDrag);
      }
    });
  </script>

</body>
</html>
